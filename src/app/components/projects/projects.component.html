<section id="projects" class="py-16 md:py-24" appAnimateOnScroll>
  <div class="container mx-auto px-4">
    <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">{{ 'PROJECTS.TITLE' | translate }}</h2>
    <p class="text-center text-gray-600 dark:text-gray-300 mb-12 max-w-2xl mx-auto">{{ 'PROJECTS.SUBTITLE' | translate }}</p>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      
      <mat-card *ngFor="let project of projects; let i = index" class="project-card group">
        
        <div class="project-image-container">
          <!-- On boucle directement sur le tableau d'images stocké dans le projet -->
          <ng-container *ngFor="let imageUrl of project.imageUrls; let imgIndex = index">
            <img [src]="imageUrl" [alt]="(('PROJECTS_DATA.' + i + '.TITLE') | translate) + ' - Screenshot ' + (imgIndex + 1)"
                 [class.active]="imgIndex === project.currentImageIndex"
                 class="project-image">
          </ng-container>

          <div class="carousel-overlay">
            <!-- La fonction (click) est maintenant simple et directe, SANS pipe -->
            <button mat-icon-button class="carousel-control prev" (click)="prevImage(project)">
              <mat-icon>keyboard_arrow_left</mat-icon>
            </button>
            <button mat-icon-button class="carousel-control next" (click)="nextImage(project)">
              <mat-icon>keyboard_arrow_right</mat-icon>
            </button>
          </div>

          <div class="carousel-dots">
            <!-- On boucle sur project.imageUrls, qui est un simple tableau -->
            <span *ngFor="let imageUrl of project.imageUrls; let imgIndex = index"
                  [class.active]="imgIndex === project.currentImageIndex"
                  class="dot">
            </span>
          </div>
        </div>

        <mat-card-header class="!pt-6">
          <mat-card-title class="!text-xl !font-bold">
            <!-- Ici, l'utilisation du pipe est correcte car c'est pour l'affichage -->
            {{ ('PROJECTS_DATA.' + i + '.TITLE') | translate }}
          </mat-card-title>
        </mat-card-header>

        <mat-card-content class="!pt-4 flex-grow">
          <mat-chip-listbox aria-label="Technologies">
            <div class="flex flex-wrap gap-2 mb-4">
              <mat-chip *ngFor="let tech of (('PROJECTS_DATA.' + i + '.TECHS') | translate)" class="!font-medium">
                {{ tech }}
              </mat-chip>
            </div>
          </mat-chip-listbox>
          <p class="text-gray-700 dark:text-gray-300">{{ ('PROJECTS_DATA.' + i + '.DESCRIPTION') | translate }}</p>
        </mat-card-content>

        <mat-card-actions class="!p-4 !pt-2">
          <a *ngIf="project.projectUrl" [href]="project.projectUrl" target="_blank" mat-flat-button color="primary">Voir la Démo</a>
          <a *ngIf="project.repoUrl" [href]="project.repoUrl" target="_blank" mat-stroked-button>Code Source</a>
        </mat-card-actions>
      </mat-card>

    </div>
  </div>
</section>